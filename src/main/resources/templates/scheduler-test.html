<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ERI ìŠ¤ì¼€ì¤„ë§ ë°°ì¹˜ í…ŒìŠ¤íŠ¸</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“…</text></svg>">
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .scheduler-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .scheduler-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #555;
        }
        .scheduler-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .cron-info {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 14px;
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .btn.danger {
            background-color: #dc3545;
        }
        .btn.danger:hover {
            background-color: #c82333;
        }
        .result {
            margin-top: 15px;
            padding: 15px;
            border-radius: 5px;
            display: none;
            white-space: pre-wrap;
            font-family: monospace;
            font-size: 12px;
        }
        .result.success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .result.error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .result.info {
            background-color: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .loading {
            display: none;
            color: #007bff;
            font-style: italic;
        }
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .status-item {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }
        .status-item h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
        .status-item p {
            margin: 5px 0;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ERI ìŠ¤ì¼€ì¤„ë§ ë°°ì¹˜ í…ŒìŠ¤íŠ¸</h1>
        
        <!-- ìŠ¤ì¼€ì¤„ë§ ìƒíƒœ í™•ì¸ -->
        <div class="scheduler-section">
            <div class="scheduler-title">1. ìŠ¤ì¼€ì¤„ë§ ìƒíƒœ í™•ì¸</div>
            <div class="scheduler-description">
                í˜„ì¬ ë“±ë¡ëœ ìŠ¤ì¼€ì¤„ë§ ì‘ì—…ë“¤ì˜ ìƒíƒœì™€ ì‹¤í–‰ ì‹œê°„ì„ í™•ì¸í•©ë‹ˆë‹¤.
            </div>
            <button class="btn" onclick="getSchedulerStatus()">ìƒíƒœ í™•ì¸</button>
            <div class="loading" id="statusLoading">ìƒíƒœ í™•ì¸ ì¤‘...</div>
            <div class="result" id="statusResult"></div>
        </div>

        <!-- ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ -->
        <div class="scheduler-section">
            <div class="scheduler-title">2. ì•”í˜¸í™” ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸</div>
            <div class="scheduler-description">
                eri_enc_db ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ìƒíƒœì™€ TB_EMP_ENCRYPT í…Œì´ë¸” ì ‘ê·¼ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.
                <br>
                - ë°ì´í„°ë² ì´ìŠ¤: eri_enc_db (PostgreSQL)
                <br>
                - í…Œì´ë¸”: TB_EMP_ENCRYPT
                <br>
                - ì—°ê²° í’€: HikariCP
            </div>
            <button class="btn" onclick="testDatabaseConnection()">ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸</button>
            <div class="loading" id="dbLoading">ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...</div>
            <div class="result" id="dbResult"></div>
        </div>

        <!-- ìˆ˜ë™ ë°°ì¹˜ ì‹¤í–‰ -->
        <div class="scheduler-section">
            <div class="scheduler-title">3. ì§ì› ì •ë³´ ì•”í˜¸í™” ë°°ì¹˜ ìˆ˜ë™ ì‹¤í–‰</div>
            <div class="scheduler-description">
                empInfo.txt íŒŒì¼ì„ ì½ì–´ì„œ ì§ì›ë²ˆí˜¸, ì§ì›ëª…, ì§ì›ì´ë©”ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ë°°ì¹˜ë¥¼ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•©ë‹ˆë‹¤.
                <br>
                - íŒŒì¼ ìœ„ì¹˜: src/main/resources/templates/empInfo.txt
                <br>
                - ì²˜ë¦¬ ë°©ì‹: ì§ì›ë²ˆí˜¸ SHA256 í•´ì‹œ, ì§ì›ëª… ëœë¤ ë³€í˜•, ì´ë©”ì¼ ì›ë³¸ ì €ì¥
                <br>
                - ì²˜ë¦¬ ê³¼ì •: ì›ë³¸ ë°ì´í„° â†’ í•´ì‹œ/ë³€í˜• â†’ TB_EMP_ENCRYPT í…Œì´ë¸” ì €ì¥
            </div>
            <div class="cron-info">
                <strong>ì •ê¸° ì‹¤í–‰ ìŠ¤ì¼€ì¤„:</strong> ë§¤ì¼ ì˜¤ì „ 2ì‹œ (0 0 2 * * ?)
            </div>
            <button class="btn" onclick="runManualBatch()">ìˆ˜ë™ ë°°ì¹˜ ì‹¤í–‰</button>
            <div class="loading" id="batchLoading">ë°°ì¹˜ ì‹¤í–‰ ì¤‘...</div>
            <div class="result" id="batchResult"></div>
        </div>

        <!-- ìŠ¤ì¼€ì¤„ë§ ì •ë³´ -->
        <div class="scheduler-section">
            <div class="scheduler-title">3. ìŠ¤ì¼€ì¤„ë§ ì •ë³´</div>
            <div class="scheduler-description">
                ë“±ë¡ëœ ëª¨ë“  ìŠ¤ì¼€ì¤„ë§ ì‘ì—…ë“¤ì˜ ì •ë³´ì…ë‹ˆë‹¤.
            </div>
            <div class="status-grid">
                <div class="status-item">
                    <h4>ğŸ“… ì¼ì¼ ë°°ì¹˜</h4>
                    <p><strong>ì‘ì—…ëª…:</strong> ì§ì› ì •ë³´ í•´ì‹œ ì²˜ë¦¬</p>
                    <p><strong>ì‹¤í–‰ ì‹œê°„:</strong> ë§¤ì¼ ì˜¤ì „ 2ì‹œ</p>
                    <p><strong>Cron í‘œí˜„ì‹:</strong> 0 0 2 * * ?</p>
                    <p><strong>ì„¤ëª…:</strong> empInfo.txt íŒŒì¼ ì½ì–´ì„œ ì§ì› ì •ë³´ SHA256 í•´ì‹œ ë° ì´ë©”ì¼ ì²˜ë¦¬</p>
                </div>
                <div class="status-item">
                    <h4>ğŸ—‘ï¸ ì£¼ê°„ ì •ë¦¬</h4>
                    <p><strong>ì‘ì—…ëª…:</strong> ì˜¤ë˜ëœ ë°ì´í„° ì •ë¦¬</p>
                    <p><strong>ì‹¤í–‰ ì‹œê°„:</strong> ë§¤ì£¼ ì¼ìš”ì¼ ì˜¤ì „ 3ì‹œ</p>
                    <p><strong>Cron í‘œí˜„ì‹:</strong> 0 0 3 ? * SUN</p>
                    <p><strong>ì„¤ëª…:</strong> 30ì¼ ì´ìƒ ëœ ì‚­ì œëœ ë ˆì½”ë“œ ì •ë¦¬</p>
                </div>
                <div class="status-item">
                    <h4>ğŸ“Š ì›”ê°„ í†µê³„</h4>
                    <p><strong>ì‘ì—…ëª…:</strong> ì•”í˜¸í™” í†µê³„ ìƒì„±</p>
                    <p><strong>ì‹¤í–‰ ì‹œê°„:</strong> ë§¤ì›” 1ì¼ ì˜¤ì „ 4ì‹œ</p>
                    <p><strong>Cron í‘œí˜„ì‹:</strong> 0 0 4 1 * ?</p>
                    <p><strong>ì„¤ëª…:</strong> ì „ì²´ ë° ì›”ê°„ ì•”í˜¸í™” í†µê³„ ì¡°íšŒ</p>
                </div>
            </div>
        </div>

        <!-- ë™ì  ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë¦¬ -->
        <div class="scheduler-section">
            <div class="scheduler-title">4. ë™ì  ìŠ¤ì¼€ì¤„ëŸ¬ ê´€ë¦¬</div>
            <div class="scheduler-description">
                scheduler_empInfo.txt íŒŒì¼ì„ ì½ì–´ì„œ ë™ì ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.
            </div>
            <div class="button-group">
                <button class="btn" onclick="reloadScheduleConfig()">ì„¤ì • ì¬ë¡œë“œ</button>
                <button class="btn" onclick="executeSpecificMethod()">íŠ¹ì • ë©”ì†Œë“œ ì‹¤í–‰</button>
            </div>
            <div class="form-group" style="margin-top: 15px;">
                <label for="methodSelect">ì‹¤í–‰í•  ë©”ì†Œë“œ:</label>
                <select id="methodSelect" class="form-control" style="width: 200px; padding: 5px; margin-left: 10px;">
                    <option value="dailyEmpEncryptBatch">dailyEmpEncryptBatch</option>
                    <option value="weeklyCleanupBatch">weeklyCleanupBatch</option>
                    <option value="monthlyStatisticsBatch">monthlyStatisticsBatch</option>
                    <option value="manualEmpEncryptBatch">manualEmpEncryptBatch</option>
                </select>
            </div>
            <div class="loading" id="dynamicLoading">ì²˜ë¦¬ ì¤‘...</div>
            <div class="result" id="dynamicResult"></div>
        </div>

        <!-- Cron í‘œí˜„ì‹ ì„¤ëª… -->
        <div class="scheduler-section">
            <div class="scheduler-title">5. Cron í‘œí˜„ì‹ ì„¤ëª…</div>
            <div class="scheduler-description">
                Cron í‘œí˜„ì‹ì€ 6ê°œ ë˜ëŠ” 7ê°œì˜ í•„ë“œë¡œ êµ¬ì„±ë©ë‹ˆë‹¤.
            </div>
            <div class="cron-info">
                <strong>í˜•ì‹:</strong> ì´ˆ ë¶„ ì‹œ ì¼ ì›” ìš”ì¼ [ë…„ë„]
                <br><strong>ì˜ˆì‹œ:</strong> 0 0 2 * * ? (ë§¤ì¼ ì˜¤ì „ 2ì‹œ)
                <br><strong>í•„ë“œ:</strong> ì´ˆ(0-59) ë¶„(0-59) ì‹œ(0-23) ì¼(1-31) ì›”(1-12) ìš”ì¼(1-7 ë˜ëŠ” SUN-SAT)
                <br><strong>íŠ¹ìˆ˜ë¬¸ì:</strong> * (ëª¨ë“  ê°’) ? (ê°’ ì—†ìŒ) / (ì¦ë¶„) - (ë²”ìœ„) , (ì—¬ëŸ¬ ê°’)
            </div>
        </div>
    </div>

    <script>
        function testDatabaseConnection() {
            const button = event.target;
            const loading = document.getElementById('dbLoading');
            const result = document.getElementById('dbResult');
            
            button.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';
            
            fetch('/api/scheduler/test-db-connection', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                result.style.display = 'block';
                
                if (data.success) {
                    result.className = 'result success';
                    let html = `<strong>âœ… ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì™„ë£Œ!</strong>\n\n`;
                    html += `ë©”ì‹œì§€: ${data.message}\n`;
                    html += `í…ŒìŠ¤íŠ¸ ì‹œê°„: ${new Date(data.timestamp).toLocaleString()}\n`;
                    
                    result.innerHTML = html;
                } else {
                    result.className = 'result error';
                    let html = `âŒ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨!\n\n`;
                    html += `ì˜¤ë¥˜: ${data.message}\n`;
                    html += `ì˜¤ë¥˜ íƒ€ì…: ${data.error || 'Unknown'}\n`;
                    html += `ì‹œê°„: ${new Date(data.timestamp).toLocaleString()}\n`;
                    
                    result.innerHTML = html;
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                result.style.display = 'block';
                result.className = 'result error';
                result.innerHTML = `âŒ ì˜¤ë¥˜ ë°œìƒ!\n\në©”ì‹œì§€: ${error.message}\n\nì‹œê°„: ${new Date().toLocaleString()}`;
            })
            .finally(() => {
                button.disabled = false;
            });
        }

        function getSchedulerStatus() {
            const button = event.target;
            const loading = document.getElementById('statusLoading');
            const result = document.getElementById('statusResult');
            
            button.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';
            
            fetch('/api/scheduler/status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                result.style.display = 'block';
                
                if (data.success) {
                    result.className = 'result success';
                    let html = `<strong>âœ… ìŠ¤ì¼€ì¤„ë§ ìƒíƒœ ì¡°íšŒ ì™„ë£Œ!</strong>\n\n`;
                    
                    if (data.status) {
                        html += `<strong>ìŠ¤ì¼€ì¤„ë§ ì •ë³´:</strong>\n`;
                        for (const [key, value] of Object.entries(data.status)) {
                            html += `${key}: ${value}\n`;
                        }
                    }
                    
                    result.innerHTML = html;
                } else {
                    result.className = 'result error';
                    result.innerHTML = `âŒ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨!\n\nì˜¤ë¥˜: ${data.message}\n\nì‹œê°„: ${new Date(data.timestamp).toLocaleString()}`;
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                result.style.display = 'block';
                result.className = 'result error';
                result.innerHTML = `âŒ ì˜¤ë¥˜ ë°œìƒ!\n\në©”ì‹œì§€: ${error.message}\n\nì‹œê°„: ${new Date().toLocaleString()}`;
            })
            .finally(() => {
                button.disabled = false;
            });
        }

        function runManualBatch() {
            const button = event.target;
            const loading = document.getElementById('batchLoading');
            const result = document.getElementById('batchResult');
            
            button.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';
            
            fetch('/api/scheduler/manual-emp-encrypt', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                result.style.display = 'block';
                
                if (data.success) {
                    result.className = 'result success';
                    let html = `<strong>âœ… ë°°ì¹˜ ì‹¤í–‰ ì™„ë£Œ!</strong>\n\n`;
                    html += `ë©”ì‹œì§€: ${data.message}\n`;
                    html += `ì²˜ë¦¬ ì‹œê°„: ${data.processingTime}\n`;
                    html += `ì‹¤í–‰ ì‹œê°„: ${new Date(data.timestamp).toLocaleString()}\n`;
                    if (data.details) {
                        html += `\nìƒì„¸ ì •ë³´: ${data.details}\n`;
                    }
                    
                    result.innerHTML = html;
                } else {
                    result.className = 'result error';
                    let html = `âŒ ë°°ì¹˜ ì‹¤í–‰ ì‹¤íŒ¨!\n\n`;
                    html += `ì˜¤ë¥˜: ${data.message}\n`;
                    html += `ì˜¤ë¥˜ íƒ€ì…: ${data.error || 'Unknown'}\n`;
                    html += `ì‹œê°„: ${new Date(data.timestamp).toLocaleString()}\n`;
                    if (data.details) {
                        html += `\nìƒì„¸ ì •ë³´: ${data.details}\n`;
                    }
                    
                    result.innerHTML = html;
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                result.style.display = 'block';
                result.className = 'result error';
                result.innerHTML = `âŒ ì˜¤ë¥˜ ë°œìƒ!\n\në©”ì‹œì§€: ${error.message}\n\nì‹œê°„: ${new Date().toLocaleString()}`;
            })
            .finally(() => {
                button.disabled = false;
            });
        }

        function reloadScheduleConfig() {
            const button = event.target;
            const loading = document.getElementById('dynamicLoading');
            const result = document.getElementById('dynamicResult');
            
            button.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';
            
            fetch('/api/scheduler/reload-config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                }
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                result.style.display = 'block';
                
                if (data.success) {
                    result.className = 'result success';
                    let html = `<strong>âœ… ìŠ¤ì¼€ì¤„ ì„¤ì • ì¬ë¡œë“œ ì™„ë£Œ!</strong>\n\n`;
                    
                    if (data.scheduleConfig) {
                        html += `<strong>ìŠ¤ì¼€ì¤„ ì„¤ì •:</strong>\n`;
                        for (const [method, cron] of Object.entries(data.scheduleConfig)) {
                            html += `${method} = ${cron}\n`;
                        }
                    }
                    
                    if (data.validationResults) {
                        html += `\n<strong>ìœ íš¨ì„± ê²€ì¦ ê²°ê³¼:</strong>\n`;
                        for (const [method, isValid] of Object.entries(data.validationResults)) {
                            const status = isValid ? 'âœ… ìœ íš¨' : 'âŒ ë¬´íš¨';
                            html += `${method}: ${status}\n`;
                        }
                    }
                    
                    result.innerHTML = html;
                } else {
                    result.className = 'result error';
                    result.innerHTML = `âŒ ì„¤ì • ì¬ë¡œë“œ ì‹¤íŒ¨!\n\nì˜¤ë¥˜: ${data.message}\n\nì‹œê°„: ${new Date(data.timestamp).toLocaleString()}`;
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                result.style.display = 'block';
                result.className = 'result error';
                result.innerHTML = `âŒ ì˜¤ë¥˜ ë°œìƒ!\n\në©”ì‹œì§€: ${error.message}\n\nì‹œê°„: ${new Date().toLocaleString()}`;
            })
            .finally(() => {
                button.disabled = false;
            });
        }

        function executeSpecificMethod() {
            const methodName = document.getElementById('methodSelect').value;
            const button = event.target;
            const loading = document.getElementById('dynamicLoading');
            const result = document.getElementById('dynamicResult');
            
            button.disabled = true;
            loading.style.display = 'block';
            result.style.display = 'none';
            
            const formData = new FormData();
            formData.append('methodName', methodName);
            
            fetch('/api/scheduler/execute-method', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                loading.style.display = 'none';
                result.style.display = 'block';
                
                if (data.success) {
                    result.className = 'result success';
                    let html = `<strong>âœ… ë©”ì†Œë“œ ì‹¤í–‰ ì™„ë£Œ!</strong>\n\n`;
                    html += `ë©”ì†Œë“œ: ${data.methodName}\n`;
                    html += `ë©”ì‹œì§€: ${data.message}\n`;
                    html += `ì²˜ë¦¬ ì‹œê°„: ${data.processingTime}\n`;
                    html += `ì‹¤í–‰ ì‹œê°„: ${new Date(data.timestamp).toLocaleString()}\n`;
                    
                    result.innerHTML = html;
                } else {
                    result.className = 'result error';
                    result.innerHTML = `âŒ ë©”ì†Œë“œ ì‹¤í–‰ ì‹¤íŒ¨!\n\në©”ì†Œë“œ: ${data.methodName}\nì˜¤ë¥˜: ${data.message}\n\nì‹œê°„: ${new Date(data.timestamp).toLocaleString()}`;
                }
            })
            .catch(error => {
                loading.style.display = 'none';
                result.style.display = 'block';
                result.className = 'result error';
                result.innerHTML = `âŒ ì˜¤ë¥˜ ë°œìƒ!\n\në©”ì‹œì§€: ${error.message}\n\nì‹œê°„: ${new Date().toLocaleString()}`;
            })
            .finally(() => {
                button.disabled = false;
            });
        }
    </script>
</body>
</html> 