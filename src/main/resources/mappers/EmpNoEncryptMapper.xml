<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.EmpNoEncryptMapper">

    <!-- 전체 조회 -->
    <select id="selectAll" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT * FROM TB_EMP_NO_ENCRYPT
    </select>

    <!-- 직원 ID로 조회 -->
    <select id="selectByEmpId" parameterType="string" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT * FROM TB_EMP_NO_ENCRYPT WHERE EMP_ID = #{empId}
    </select>

    <!-- 등록 -->
    <insert id="insert" parameterType="com.ERI.demo.vo.EmpNoEncryptVO">
        INSERT INTO TB_EMP_NO_ENCRYPT (
            EMP_ID, ORIG_EMP_NO, ENCRYPT_EMP_NO, ENCRYPT_ALGORITHM, ENCRYPT_KEY_ID, ENCRYPT_IV, ENCRYPT_DATE, REG_DATE, UPD_DATE
        ) VALUES (
            #{empId}, #{origEmpNo}, #{encryptEmpNo}, #{encryptAlgorithm}, #{encryptKeyId}, #{encryptIv}, NOW(), NOW(), NOW()
        )
    </insert>

    <!-- 수정 -->
    <update id="update" parameterType="com.ERI.demo.vo.EmpNoEncryptVO">
        UPDATE TB_EMP_NO_ENCRYPT
        SET ORIG_EMP_NO = #{origEmpNo},
            ENCRYPT_EMP_NO = #{encryptEmpNo},
            ENCRYPT_ALGORITHM = #{encryptAlgorithm},
            ENCRYPT_KEY_ID = #{encryptKeyId},
            ENCRYPT_IV = #{encryptIv},
            ENCRYPT_DATE = NOW(),
            UPD_DATE = NOW()
        WHERE EMP_ID = #{empId}
    </update>

    <!-- 삭제 -->
    <delete id="deleteByEmpId" parameterType="string">
        DELETE FROM TB_EMP_NO_ENCRYPT WHERE EMP_ID = #{empId}
    </delete>

    <!-- 암호화된 직원번호로 조회 -->
    <select id="selectByEncryptEmpNo" parameterType="string" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT * FROM TB_EMP_NO_ENCRYPT WHERE ENCRYPT_EMP_NO = #{encryptEmpNo}
    </select>

    <!-- 원본 직원번호로 조회 -->
    <select id="selectByOrigEmpNo" parameterType="string" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT * FROM TB_EMP_NO_ENCRYPT WHERE ORIG_EMP_NO = #{origEmpNo}
    </select>

    <!-- 알고리즘별 조회 -->
    <select id="selectByAlgorithm" parameterType="string" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT * FROM TB_EMP_NO_ENCRYPT WHERE ENCRYPT_ALGORITHM = #{algorithm}
    </select>

    <!-- 키 ID별 조회 -->
    <select id="selectByKeyId" parameterType="string" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT * FROM TB_EMP_NO_ENCRYPT WHERE ENCRYPT_KEY_ID = #{keyId}
    </select>

    <!-- 직원번호 암호화 목록 조회 -->
    <select id="selectEmpNoEncryptList" parameterType="com.ERI.demo.vo.EmpNoEncryptVO" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT 
            EMP_ID,
            ORIGINAL_NO,
            ENCRYPTED_NO,
            KEY_ID,
            ENCRYPT_DATE,
            REG_DATE,
            UPD_DATE
        FROM TB_EMP_NO_ENCRYPT
        <where>
            <if test="empId != null and empId != ''">
                AND EMP_ID LIKE CONCAT('%', #{empId}, '%')
            </if>
        </where>
        ORDER BY REG_DATE DESC
    </select>

    <!-- 직원번호 암호화 상세 조회 -->
    <select id="selectEmpNoEncrypt" parameterType="string" resultType="com.ERI.demo.vo.EmpNoEncryptVO">
        SELECT 
            EMP_ID,
            ORIGINAL_NO,
            ENCRYPTED_NO,
            KEY_ID,
            ENCRYPT_DATE,
            REG_DATE,
            UPD_DATE
        FROM TB_EMP_NO_ENCRYPT
        WHERE EMP_ID = #{empId}
    </select>

    <!-- 직원번호 암호화 등록 -->
    <insert id="insertEmpNoEncrypt" parameterType="com.ERI.demo.vo.EmpNoEncryptVO">
        INSERT INTO TB_EMP_NO_ENCRYPT (
            EMP_ID,
            ORIGINAL_NO,
            ENCRYPTED_NO,
            KEY_ID,
            ENCRYPT_DATE,
            REG_DATE,
            UPD_DATE
        ) VALUES (
            #{empId},
            #{originalNo},
            #{encryptedNo},
            #{keyId},
            #{encryptDate},
            NOW(),
            NOW()
        )
    </insert>

    <!-- 직원번호 암호화 수정 -->
    <update id="updateEmpNoEncrypt" parameterType="com.ERI.demo.vo.EmpNoEncryptVO">
        UPDATE TB_EMP_NO_ENCRYPT
        SET ORIGINAL_NO = #{originalNo},
            ENCRYPTED_NO = #{encryptedNo},
            KEY_ID = #{keyId},
            ENCRYPT_DATE = #{encryptDate},
            UPD_DATE = NOW()
        WHERE EMP_ID = #{empId}
    </update>

    <!-- 직원번호 암호화 삭제 -->
    <delete id="deleteEmpNoEncrypt" parameterType="string">
        DELETE FROM TB_EMP_NO_ENCRYPT
        WHERE EMP_ID = #{empId}
    </delete>

</mapper> 