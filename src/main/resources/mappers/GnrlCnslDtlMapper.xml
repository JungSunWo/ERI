<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.GnrlCnslDtlMapper">

    <!-- 일반 상담 명세 목록 조회 -->
    <select id="selectGnrlCnslDtlList" parameterType="com.ERI.demo.vo.GnrlCnslDtlVO" resultType="com.ERI.demo.vo.GnrlCnslDtlVO">
        SELECT 
            APP_DT,
            CNSL_APP_SEQ,
            CNSL_SEQ,
            DTL_SEQ,
            CNSL_DTL_CNTN,
            CNSL_DTL_RCMD,
            RGST_DT,
            RGST_TM,
            RGST_EMP_ID,
            UPDT_DT,
            UPDT_TM,
            UPDT_EMP_ID
        FROM TB_GNRL_CNSL_DTL
        <where>
            <if test="appDt != null">
                AND APP_DT = #{appDt}
            </if>
            <if test="cnslAppSeq != null">
                AND CNSL_APP_SEQ = #{cnslAppSeq}
            </if>
            <if test="cnslSeq != null">
                AND CNSL_SEQ = #{cnslSeq}
            </if>
            <if test="dtlSeq != null">
                AND DTL_SEQ = #{dtlSeq}
            </if>
            <if test="cnslDtlCntn != null and cnslDtlCntn != ''">
                AND CNSL_DTL_CNTN LIKE CONCAT('%', #{cnslDtlCntn}, '%')
            </if>
            <if test="rgstEmpId != null and rgstEmpId != ''">
                AND RGST_EMP_ID = #{rgstEmpId}
            </if>
        </where>
        ORDER BY APP_DT DESC, CNSL_APP_SEQ DESC, CNSL_SEQ DESC, DTL_SEQ
    </select>

    <!-- 일반 상담 명세 상세 조회 -->
    <select id="selectGnrlCnslDtl" resultType="com.ERI.demo.vo.GnrlCnslDtlVO">
        SELECT 
            APP_DT,
            CNSL_APP_SEQ,
            CNSL_SEQ,
            DTL_SEQ,
            CNSL_DTL_CNTN,
            CNSL_DTL_RCMD,
            RGST_DT,
            RGST_TM,
            RGST_EMP_ID,
            UPDT_DT,
            UPDT_TM,
            UPDT_EMP_ID
        FROM TB_GNRL_CNSL_DTL
        WHERE APP_DT = #{appDt} AND CNSL_APP_SEQ = #{cnslAppSeq} AND CNSL_SEQ = #{cnslSeq} AND DTL_SEQ = #{dtlSeq}
    </select>

    <!-- 일반 상담 명세 등록 -->
    <insert id="insertGnrlCnslDtl" parameterType="com.ERI.demo.vo.GnrlCnslDtlVO">
        INSERT INTO TB_GNRL_CNSL_DTL (
            APP_DT,
            CNSL_APP_SEQ,
            CNSL_SEQ,
            DTL_SEQ,
            CNSL_DTL_CNTN,
            CNSL_DTL_RCMD,
            RGST_DT,
            RGST_TM,
            RGST_EMP_ID
        ) VALUES (
            #{appDt},
            #{cnslAppSeq},
            #{cnslSeq},
            #{dtlSeq},
            #{cnslDtlCntn},
            #{cnslDtlRcmd},
            #{rgstDt},
            #{rgstTm},
            #{rgstEmpId}
        )
    </insert>

    <!-- 일반 상담 명세 수정 -->
    <update id="updateGnrlCnslDtl" parameterType="com.ERI.demo.vo.GnrlCnslDtlVO">
        UPDATE TB_GNRL_CNSL_DTL
        SET 
            CNSL_DTL_CNTN = #{cnslDtlCntn},
            CNSL_DTL_RCMD = #{cnslDtlRcmd},
            UPDT_DT = #{updtDt},
            UPDT_TM = #{updtTm},
            UPDT_EMP_ID = #{updtEmpId}
        WHERE APP_DT = #{appDt} AND CNSL_APP_SEQ = #{cnslAppSeq} AND CNSL_SEQ = #{cnslSeq} AND DTL_SEQ = #{dtlSeq}
    </update>

    <!-- 일반 상담 명세 삭제 -->
    <delete id="deleteGnrlCnslDtl">
        DELETE FROM TB_GNRL_CNSL_DTL
        WHERE APP_DT = #{appDt} AND CNSL_APP_SEQ = #{cnslAppSeq} AND CNSL_SEQ = #{cnslSeq} AND DTL_SEQ = #{dtlSeq}
    </delete>

</mapper> 