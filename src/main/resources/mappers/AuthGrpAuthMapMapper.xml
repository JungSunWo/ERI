<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.AuthGrpAuthMapMapper">

    <!-- 결과 매핑 -->
    <resultMap id="AuthGrpAuthMapResultMap" type="com.ERI.demo.vo.AuthGrpAuthMapVO">
        <id column="AUTH_GRP_CD" property="authGrpCd" />
        <id column="AUTH_CD" property="authCd" />
        <result column="RGST_DT" property="rgstDt" />
        <result column="UPDT_DT" property="updtDt" />
        <result column="DEL_YN" property="delYn" />
    </resultMap>

    <!-- 권한그룹-권한 매핑 목록 조회 -->
    <select id="selectAuthGrpAuthMapList" resultMap="AuthGrpAuthMapResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY AUTH_GRP_CD, AUTH_CD) AS rowNum,
            AUTH_GRP_CD,
            AUTH_CD,
            TO_CHAR(RGST_DT, 'YYYY-MM-DD HH24:MI:SS') as RGST_DT,
            TO_CHAR(UPDT_DT, 'YYYY-MM-DD HH24:MI:SS') as UPDT_DT,
            DEL_YN
        FROM TB_AUTH_GRP_AUTH_MAP
        WHERE DEL_YN = 'N'
        ORDER BY AUTH_GRP_CD, AUTH_CD
    </select>

    <!-- 권한그룹별 권한 목록 조회 -->
    <select id="selectAuthListByAuthGrp" parameterType="string" resultMap="AuthGrpAuthMapResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY agam.AUTH_CD) AS rowNum,
            agam.AUTH_GRP_CD,
            agam.AUTH_CD,
            TO_CHAR(agam.RGST_DT, 'YYYY-MM-DD HH24:MI:SS') as RGST_DT,
            TO_CHAR(agam.UPDT_DT, 'YYYY-MM-DD HH24:MI:SS') as UPDT_DT,
            agam.DEL_YN
        FROM TB_AUTH_GRP_AUTH_MAP agam
        WHERE agam.AUTH_GRP_CD = #{authGrpCd}
        AND agam.DEL_YN = 'N'
        ORDER BY agam.AUTH_CD
    </select>

    <!-- 권한별 권한그룹 목록 조회 -->
    <select id="selectAuthGrpListByAuth" parameterType="string" resultMap="AuthGrpAuthMapResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY agam.AUTH_GRP_CD) AS rowNum,
            agam.AUTH_GRP_CD,
            agam.AUTH_CD,
            TO_CHAR(agam.RGST_DT, 'YYYY-MM-DD HH24:MI:SS') as RGST_DT,
            TO_CHAR(agam.UPDT_DT, 'YYYY-MM-DD HH24:MI:SS') as UPDT_DT,
            agam.DEL_YN
        FROM TB_AUTH_GRP_AUTH_MAP agam
        WHERE agam.AUTH_CD = #{authCd}
        AND agam.DEL_YN = 'N'
        ORDER BY agam.AUTH_GRP_CD
    </select>

    <!-- 권한그룹-권한 매핑 등록 -->
    <insert id="insertAuthGrpAuthMap" parameterType="com.ERI.demo.vo.AuthGrpAuthMapVO">
        INSERT INTO TB_AUTH_GRP_AUTH_MAP (
            AUTH_GRP_CD,
            AUTH_CD,
            RGST_DT,
            UPDT_DT,
            DEL_YN
        ) VALUES (
            #{authGrpCd},
            #{authCd},
            NOW(),
            NOW(),
            'N'
        )
    </insert>

    <!-- 권한그룹-권한 매핑 수정 -->
    <update id="updateAuthGrpAuthMap" parameterType="com.ERI.demo.vo.AuthGrpAuthMapVO">
        UPDATE TB_AUTH_GRP_AUTH_MAP
        SET 
            UPDT_DT = NOW(),
            DEL_YN = #{delYn}
        WHERE AUTH_GRP_CD = #{authGrpCd}
        AND AUTH_CD = #{authCd}
    </update>

    <!-- 권한그룹-권한 매핑 논리적 삭제 -->
    <update id="deleteAuthGrpAuthMap">
        UPDATE TB_AUTH_GRP_AUTH_MAP
        SET 
            DEL_YN = 'Y',
            UPDT_DT = NOW()
        WHERE AUTH_GRP_CD = #{authGrpCd}
        AND AUTH_CD = #{authCd}
    </update>

    <!-- 권한그룹-권한 매핑 복구 -->
    <update id="restoreAuthGrpAuthMap">
        UPDATE TB_AUTH_GRP_AUTH_MAP
        SET 
            DEL_YN = 'N',
            UPDT_DT = NOW()
        WHERE AUTH_GRP_CD = #{authGrpCd}
        AND AUTH_CD = #{authCd}
    </update>

    <!-- 삭제된 권한그룹-권한 매핑 목록 조회 -->
    <select id="selectDeletedAuthGrpAuthMapList" resultMap="AuthGrpAuthMapResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY AUTH_GRP_CD, AUTH_CD) AS rowNum,
            AUTH_GRP_CD,
            AUTH_CD,
            TO_CHAR(RGST_DT, 'YYYY-MM-DD HH24:MI:SS') as RGST_DT,
            TO_CHAR(UPDT_DT, 'YYYY-MM-DD HH24:MI:SS') as UPDT_DT,
            DEL_YN
        FROM TB_AUTH_GRP_AUTH_MAP
        WHERE DEL_YN = 'Y'
        ORDER BY AUTH_GRP_CD, AUTH_CD
    </select>

    <!-- 권한그룹-권한 매핑 존재 여부 확인 -->
    <select id="countAuthGrpAuthMap" resultType="int">
        SELECT COUNT(*)
        FROM TB_AUTH_GRP_AUTH_MAP
        WHERE AUTH_GRP_CD = #{authGrpCd}
        AND AUTH_CD = #{authCd}
        AND DEL_YN = 'N'
    </select>

</mapper> 