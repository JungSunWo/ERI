<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mapper.SurveyResponseDetailMapper">

    <!-- 설문조사 응답 상세 목록 조회 -->
    <select id="selectSurveyResponseDetailList" parameterType="long" resultType="com.ERI.demo.vo.SurveyResponseDetailVO">
        SELECT 
            RESP_DTL_SEQ,
            RESP_SEQ,
            SURV_SEQ,
            QST_SEQ,
            CHC_SEQ,
            TEXT_RESP,
            RESP_ORD,
            RESP_SCORE,
            REG_ID,
            REG_DT,
            UPD_ID,
            UPD_DT,
            DEL_YN
        FROM TB_SURV_RESP_DTL
        WHERE RESP_SEQ = #{responseSeq}
          AND DEL_YN = 'N'
        ORDER BY RESP_ORD ASC
    </select>

    <!-- 설문조사 응답 상세 상세 조회 -->
    <select id="selectSurveyResponseDetailBySeq" parameterType="long" resultType="com.ERI.demo.vo.SurveyResponseDetailVO">
        SELECT 
            RESP_DTL_SEQ,
            RESP_SEQ,
            SURV_SEQ,
            QST_SEQ,
            CHC_SEQ,
            TEXT_RESP,
            RESP_ORD,
            RESP_SCORE,
            REG_ID,
            REG_DT,
            UPD_ID,
            UPD_DT,
            DEL_YN
        FROM TB_SURV_RESP_DTL
        WHERE RESP_DTL_SEQ = #{responseDetailSeq}
          AND DEL_YN = 'N'
    </select>

    <!-- 설문조사 응답 상세 등록 -->
    <insert id="insertSurveyResponseDetail" parameterType="com.ERI.demo.vo.SurveyResponseDetailVO">
        INSERT INTO TB_SURV_RESP_DTL (
            RESP_DTL_SEQ,
            RESP_SEQ,
            SURV_SEQ,
            QST_SEQ,
            CHC_SEQ,
            TEXT_RESP,
            RESP_ORD,
            RESP_SCORE,
            REG_ID,
            REG_DT,
            DEL_YN
        ) VALUES (
            NEXTVAL('SEQ_SURV_RESP_DTL'),
            #{responseSeq},
            #{surveySeq},
            #{questionSeq},
            #{choiceSeq},
            #{textResponse},
            #{responseOrd},
            #{responseScore},
            #{regId},
            NOW(),
            'N'
        )
    </insert>

    <!-- 설문조사 응답 상세 수정 -->
    <update id="updateSurveyResponseDetail" parameterType="com.ERI.demo.vo.SurveyResponseDetailVO">
        UPDATE TB_SURV_RESP_DTL
        SET 
            CHC_SEQ = #{choiceSeq},
            TEXT_RESP = #{textResponse},
            RESP_ORD = #{responseOrd},
            RESP_SCORE = #{responseScore},
            UPD_ID = #{updId},
            UPD_DT = NOW()
        WHERE RESP_DTL_SEQ = #{responseDetailSeq}
    </update>

    <!-- 설문조사 응답 상세 삭제 -->
    <update id="deleteSurveyResponseDetail" parameterType="long">
        UPDATE TB_SURV_RESP_DTL
        SET DEL_YN = 'Y'
        WHERE RESP_DTL_SEQ = #{responseDetailSeq}
    </update>

    <!-- 응답별 상세 목록 삭제 -->
    <update id="deleteResponseDetailsByResponseSeq" parameterType="long">
        UPDATE TB_SURV_RESP_DTL
        SET DEL_YN = 'Y'
        WHERE RESP_SEQ = #{responseSeq}
    </update>

    <!-- 질문별 응답 상세 조회 -->
    <select id="selectResponseDetailsByQuestion" resultType="com.ERI.demo.vo.SurveyResponseDetailVO">
        SELECT 
            RESP_DTL_SEQ,
            RESP_SEQ,
            SURV_SEQ,
            QST_SEQ,
            CHC_SEQ,
            TEXT_RESP,
            RESP_ORD,
            RESP_SCORE,
            REG_ID,
            REG_DT,
            UPD_ID,
            UPD_DT,
            DEL_YN
        FROM TB_SURV_RESP_DTL
        WHERE SURV_SEQ = #{surveySeq}
          AND QST_SEQ = #{questionSeq}
          AND DEL_YN = 'N'
        ORDER BY RESP_SEQ ASC, RESP_ORD ASC
    </select>

    <!-- 선택지별 응답 상세 조회 -->
    <select id="selectResponseDetailsByChoice" resultType="com.ERI.demo.vo.SurveyResponseDetailVO">
        SELECT 
            RESP_DTL_SEQ,
            RESP_SEQ,
            SURV_SEQ,
            QST_SEQ,
            CHC_SEQ,
            TEXT_RESP,
            RESP_ORD,
            RESP_SCORE,
            REG_ID,
            REG_DT,
            UPD_ID,
            UPD_DT,
            DEL_YN
        FROM TB_SURV_RESP_DTL
        WHERE SURV_SEQ = #{surveySeq}
          AND CHC_SEQ = #{choiceSeq}
          AND DEL_YN = 'N'
        ORDER BY RESP_SEQ ASC
    </select>

</mapper> 