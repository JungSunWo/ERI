<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.PgmLstMapper">

    <!-- 프로그램 목록 조회 (페이징) -->
    <select id="selectPgmLstListWithPaging" resultType="com.ERI.demo.vo.PgmLstVO">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SEQ DESC) AS rowNum,
            SEQ,
            PGM_ID,
            PGM_NM,
            PGM_DESC,
            PGM_TY_CD,
            PGM_APP_UNIT_CD,
            PGM_STT_DT,
            PGM_END_DT,
            PGM_STT_TM,
            PGM_END_TM,
            PGM_PLCE,
            PGM_CNT,
            PGM_CNT_LMT,
            PGM_STS_CD,
            RGST_DT,
            RGST_TM,
            REG_EMP_ID,
            UPDT_DT,
            UPDT_TM,
            UPD_EMP_ID
        FROM TB_PGM_LST
        <where>
            <if test="empLstVO.seq != null">
                AND SEQ = #{empLstVO.seq}
            </if>
            <if test="empLstVO.pgmId != null and empLstVO.pgmId != ''">
                AND PGM_ID = #{empLstVO.pgmId}
            </if>
            <if test="empLstVO.pgmNm != null and empLstVO.pgmNm != ''">
                AND PGM_NM LIKE CONCAT('%', #{empLstVO.pgmNm}, '%')
            </if>
            <if test="empLstVO.pgmTyCd != null and empLstVO.pgmTyCd != ''">
                AND PGM_TY_CD = #{empLstVO.pgmTyCd}
            </if>
            <if test="empLstVO.pgmAppUnitCd != null and empLstVO.pgmAppUnitCd != ''">
                AND PGM_APP_UNIT_CD = #{empLstVO.pgmAppUnitCd}
            </if>
            <if test="empLstVO.pgmStsCd != null and empLstVO.pgmStsCd != ''">
                AND PGM_STS_CD = #{empLstVO.pgmStsCd}
            </if>
            <if test="empLstVO.regEmpId != null and empLstVO.regEmpId != ''">
                AND REG_EMP_ID = #{empLstVO.regEmpId}
            </if>
            <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
                <choose>
                    <when test="pageRequest.searchField == 'pgmId'">
                        AND PGM_ID LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'pgmNm'">
                        AND PGM_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'pgmDesc'">
                        AND PGM_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <otherwise>
                        AND (PGM_ID LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR PGM_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR PGM_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                    </otherwise>
                </choose>
            </if>
        </where>
        <choose>
            <when test="pageRequest.sortBy != null and pageRequest.sortBy != ''">
                ORDER BY ${pageRequest.sortBy} ${pageRequest.sortDirection}
            </when>
            <otherwise>
                ORDER BY SEQ DESC
            </otherwise>
        </choose>
        LIMIT #{pageRequest.size} OFFSET #{pageRequest.offset}
    </select>

    <!-- 프로그램 목록 수 조회 -->
    <select id="selectPgmLstListCount" resultType="long">
        SELECT COUNT(*)
        FROM TB_PGM_LST
        <where>
            <if test="empLstVO.seq != null">
                AND SEQ = #{empLstVO.seq}
            </if>
            <if test="empLstVO.pgmId != null and empLstVO.pgmId != ''">
                AND PGM_ID = #{empLstVO.pgmId}
            </if>
            <if test="empLstVO.pgmNm != null and empLstVO.pgmNm != ''">
                AND PGM_NM LIKE CONCAT('%', #{empLstVO.pgmNm}, '%')
            </if>
            <if test="empLstVO.pgmTyCd != null and empLstVO.pgmTyCd != ''">
                AND PGM_TY_CD = #{empLstVO.pgmTyCd}
            </if>
            <if test="empLstVO.pgmAppUnitCd != null and empLstVO.pgmAppUnitCd != ''">
                AND PGM_APP_UNIT_CD = #{empLstVO.pgmAppUnitCd}
            </if>
            <if test="empLstVO.pgmStsCd != null and empLstVO.pgmStsCd != ''">
                AND PGM_STS_CD = #{empLstVO.pgmStsCd}
            </if>
            <if test="empLstVO.regEmpId != null and empLstVO.regEmpId != ''">
                AND REG_EMP_ID = #{empLstVO.regEmpId}
            </if>
            <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
                <choose>
                    <when test="pageRequest.searchField == 'pgmId'">
                        AND PGM_ID LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'pgmNm'">
                        AND PGM_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'pgmDesc'">
                        AND PGM_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <otherwise>
                        AND (PGM_ID LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR PGM_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR PGM_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>

    <!-- 프로그램 목록 조회 (페이징 없음) -->
    <select id="selectPgmLstList" parameterType="com.ERI.demo.vo.PgmLstVO" resultType="com.ERI.demo.vo.PgmLstVO">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SEQ DESC) AS rowNum,
            SEQ,
            PGM_ID,
            PGM_NM,
            PGM_DESC,
            PGM_TY_CD,
            PGM_APP_UNIT_CD,
            PGM_STT_DT,
            PGM_END_DT,
            PGM_STT_TM,
            PGM_END_TM,
            PGM_PLCE,
            PGM_CNT,
            PGM_CNT_LMT,
            PGM_STS_CD,
            RGST_DT,
            RGST_TM,
            REG_EMP_ID,
            UPDT_DT,
            UPDT_TM,
            UPD_EMP_ID
        FROM TB_PGM_LST
        <where>
            <if test="seq != null">
                AND SEQ = #{seq}
            </if>
            <if test="pgmId != null and pgmId != ''">
                AND PGM_ID = #{pgmId}
            </if>
            <if test="pgmNm != null and pgmNm != ''">
                AND PGM_NM LIKE CONCAT('%', #{pgmNm}, '%')
            </if>
            <if test="pgmTyCd != null and pgmTyCd != ''">
                AND PGM_TY_CD = #{pgmTyCd}
            </if>
            <if test="pgmAppUnitCd != null and pgmAppUnitCd != ''">
                AND PGM_APP_UNIT_CD = #{pgmAppUnitCd}
            </if>
            <if test="pgmStsCd != null and pgmStsCd != ''">
                AND PGM_STS_CD = #{pgmStsCd}
            </if>
            <if test="regEmpId != null and regEmpId != ''">
                AND REG_EMP_ID = #{regEmpId}
            </if>
        </where>
        ORDER BY SEQ DESC
    </select>

    <!-- 프로그램 상세 조회 -->
    <select id="selectPgmLst" parameterType="long" resultType="com.ERI.demo.vo.PgmLstVO">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SEQ DESC) AS rowNum,
            SEQ,
            PGM_ID,
            PGM_NM,
            PGM_DESC,
            PGM_TY_CD,
            PGM_APP_UNIT_CD,
            PGM_STT_DT,
            PGM_END_DT,
            PGM_STT_TM,
            PGM_END_TM,
            PGM_PLCE,
            PGM_CNT,
            PGM_CNT_LMT,
            PGM_STS_CD,
            RGST_DT,
            RGST_TM,
            REG_EMP_ID,
            UPDT_DT,
            UPDT_TM,
            UPD_EMP_ID
        FROM TB_PGM_LST
        WHERE SEQ = #{seq}
    </select>

    <!-- 프로그램 등록 -->
    <insert id="insertPgmLst" parameterType="com.ERI.demo.vo.PgmLstVO">
        INSERT INTO TB_PGM_LST (
            SEQ,
            PGM_ID,
            PGM_NM,
            PGM_DESC,
            PGM_TY_CD,
            PGM_APP_UNIT_CD,
            PGM_STT_DT,
            PGM_END_DT,
            PGM_STT_TM,
            PGM_END_TM,
            PGM_PLCE,
            PGM_CNT,
            PGM_CNT_LMT,
            PGM_STS_CD,
            RGST_DT,
            RGST_TM,
            REG_EMP_ID
        ) VALUES (
            #{seq},
            #{pgmId},
            #{pgmNm},
            #{pgmDesc},
            #{pgmTyCd},
            #{pgmAppUnitCd},
            #{pgmSttDt},
            #{pgmEndDt},
            #{pgmSttTm},
            #{pgmEndTm},
            #{pgmPlce},
            #{pgmCnt},
            #{pgmCntLmt},
            #{pgmStsCd},
            #{rgstDt},
            #{rgstTm},
            #{regEmpId}
        )
    </insert>

    <!-- 프로그램 수정 -->
    <update id="updatePgmLst" parameterType="com.ERI.demo.vo.PgmLstVO">
        UPDATE TB_PGM_LST
        SET 
            PGM_ID = #{pgmId},
            PGM_NM = #{pgmNm},
            PGM_DESC = #{pgmDesc},
            PGM_TY_CD = #{pgmTyCd},
            PGM_APP_UNIT_CD = #{pgmAppUnitCd},
            PGM_STT_DT = #{pgmSttDt},
            PGM_END_DT = #{pgmEndDt},
            PGM_STT_TM = #{pgmSttTm},
            PGM_END_TM = #{pgmEndTm},
            PGM_PLCE = #{pgmPlce},
            PGM_CNT = #{pgmCnt},
            PGM_CNT_LMT = #{pgmCntLmt},
            PGM_STS_CD = #{pgmStsCd},
            UPDT_DT = #{updtDt},
            UPDT_TM = #{updtTm},
            UPD_EMP_ID = #{updEmpId}
        WHERE SEQ = #{seq}
    </update>

    <!-- 프로그램 삭제 -->
    <delete id="deletePgmLst" parameterType="long">
        DELETE FROM TB_PGM_LST
        WHERE SEQ = #{seq}
    </delete>

</mapper> 