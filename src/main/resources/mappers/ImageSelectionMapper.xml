<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mapper.ImageSelectionMapper">

    <!-- 결과 맵 -->
    <resultMap id="ImageSelectionResultMap" type="com.ERI.demo.vo.ImageSelectionVO">
        <id property="imgSelSeq" column="IMG_SEL_SEQ"/>
        <result property="imgBrdSeq" column="IMG_BRD_SEQ"/>
        <result property="imgFileSeq" column="IMG_FILE_SEQ"/>
        <result property="selEmpId" column="SEL_EMP_ID"/>
        <result property="selDt" column="SEL_DT"/>
    </resultMap>

    <!-- 기본 조회 컬럼 -->
    <sql id="Base_Column_List">
        IMG_SEL_SEQ,
        IMG_BRD_SEQ,
        IMG_FILE_SEQ,
        SEL_EMP_ID,
        SEL_DT
    </sql>

    <!-- 기본 WHERE 조건 -->
    <sql id="Base_Where_Clause">
        WHERE 1=1
        <if test="imgBrdSeq != null">
            AND IMG_BRD_SEQ = #{imgBrdSeq}
        </if>
        <if test="imgFileSeq != null">
            AND IMG_FILE_SEQ = #{imgFileSeq}
        </if>
        <if test="selEmpId != null and selEmpId != ''">
            AND SEL_EMP_ID = #{selEmpId}
        </if>
        <if test="searchType != null and searchKeyword != null and searchKeyword != ''">
            <choose>
                <when test="searchType == 'selEmpId'">
                    AND SEL_EMP_ID LIKE '%' || #{searchKeyword} || '%'
                </when>
            </choose>
        </if>
    </sql>

    <!-- 이미지 선택 목록 조회 -->
    <select id="selectImageSelectionList" parameterType="com.ERI.demo.vo.ImageSelectionVO" resultMap="ImageSelectionResultMap">
        SELECT 
            <include refid="Base_Column_List"/>
        FROM TB_IMG_SEL_LST
        <include refid="Base_Where_Clause"/>
        <choose>
            <when test="sortBy != null and sortBy != ''">
                ORDER BY ${sortBy} ${sortDirection}
            </when>
            <otherwise>
                ORDER BY SEL_DT DESC
            </otherwise>
        </choose>
        <if test="page != null and size != null">
            LIMIT #{size} OFFSET (#{page} - 1) * #{size}
        </if>
    </select>

    <!-- 이미지 선택 목록 개수 조회 -->
    <select id="selectImageSelectionCount" parameterType="com.ERI.demo.vo.ImageSelectionVO" resultType="int">
        SELECT COUNT(*)
        FROM TB_IMG_SEL_LST
        <include refid="Base_Where_Clause"/>
    </select>

    <!-- 이미지 선택 상세 조회 -->
    <select id="selectImageSelectionBySeq" parameterType="long" resultMap="ImageSelectionResultMap">
        SELECT 
            <include refid="Base_Column_List"/>
        FROM TB_IMG_SEL_LST
        WHERE IMG_SEL_SEQ = #{imgSelSeq}
    </select>

    <!-- 이미지 게시판별 선택 목록 조회 -->
    <select id="selectImageSelectionByBrdSeq" parameterType="long" resultMap="ImageSelectionResultMap">
        SELECT 
            <include refid="Base_Column_List"/>
        FROM TB_IMG_SEL_LST
        WHERE IMG_BRD_SEQ = #{imgBrdSeq}
        ORDER BY SEL_DT DESC
    </select>

    <!-- 직원별 선택 목록 조회 -->
    <select id="selectImageSelectionByEmpId" parameterType="string" resultMap="ImageSelectionResultMap">
        SELECT 
            <include refid="Base_Column_List"/>
        FROM TB_IMG_SEL_LST
        WHERE SEL_EMP_ID = #{selEmpId}
        ORDER BY SEL_DT DESC
    </select>

    <!-- 이미지 파일별 선택 목록 조회 -->
    <select id="selectImageSelectionByFileSeq" parameterType="long" resultMap="ImageSelectionResultMap">
        SELECT 
            <include refid="Base_Column_List"/>
        FROM TB_IMG_SEL_LST
        WHERE IMG_FILE_SEQ = #{imgFileSeq}
        ORDER BY SEL_DT DESC
    </select>

    <!-- 이미지 선택 등록 -->
    <insert id="insertImageSelection" parameterType="com.ERI.demo.vo.ImageSelectionVO" useGeneratedKeys="true" keyProperty="imgSelSeq">
        INSERT INTO TB_IMG_SEL_LST (
            IMG_BRD_SEQ,
            IMG_FILE_SEQ,
            SEL_EMP_ID,
            SEL_DT
        ) VALUES (
            #{imgBrdSeq},
            #{imgFileSeq},
            #{selEmpId},
            CURRENT_TIMESTAMP
        )
    </insert>

    <!-- 이미지 선택 삭제 -->
    <delete id="deleteImageSelection" parameterType="long">
        DELETE FROM TB_IMG_SEL_LST
        WHERE IMG_SEL_SEQ = #{imgSelSeq}
    </delete>

    <!-- 직원별 이미지 선택 삭제 -->
    <delete id="deleteImageSelectionByEmpId" parameterType="map">
        DELETE FROM TB_IMG_SEL_LST
        WHERE IMG_BRD_SEQ = #{imgBrdSeq}
        AND SEL_EMP_ID = #{selEmpId}
    </delete>

    <!-- 이미지 게시판별 선택 삭제 -->
    <delete id="deleteImageSelectionByBrdSeq" parameterType="long">
        DELETE FROM TB_IMG_SEL_LST
        WHERE IMG_BRD_SEQ = #{imgBrdSeq}
    </delete>

    <!-- 이미지 파일별 선택 삭제 -->
    <delete id="deleteImageSelectionByFileSeq" parameterType="long">
        DELETE FROM TB_IMG_SEL_LST
        WHERE IMG_FILE_SEQ = #{imgFileSeq}
    </delete>

    <!-- 직원의 이미지 선택 여부 확인 -->
    <select id="checkImageSelection" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM TB_IMG_SEL_LST
        WHERE IMG_BRD_SEQ = #{imgBrdSeq}
        AND IMG_FILE_SEQ = #{imgFileSeq}
        AND SEL_EMP_ID = #{selEmpId}
    </select>

    <!-- 직원의 선택 개수 조회 -->
    <select id="countImageSelectionByEmpId" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM TB_IMG_SEL_LST
        WHERE IMG_BRD_SEQ = #{imgBrdSeq}
        AND SEL_EMP_ID = #{selEmpId}
    </select>

    <!-- 이미지 파일의 선택 개수 조회 -->
    <select id="countImageSelectionByFileSeq" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM TB_IMG_SEL_LST
        WHERE IMG_FILE_SEQ = #{imgFileSeq}
    </select>

    <!-- 이미지 게시판의 전체 선택 개수 조회 -->
    <select id="countImageSelectionByBrdSeq" parameterType="long" resultType="int">
        SELECT COUNT(*)
        FROM TB_IMG_SEL_LST
        WHERE IMG_BRD_SEQ = #{imgBrdSeq}
    </select>

</mapper> 