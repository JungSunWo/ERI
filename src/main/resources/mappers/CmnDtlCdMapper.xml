<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.CmnDtlCdMapper">

    <!-- 결과 매핑 -->
    <resultMap id="CmnDtlCdResultMap" type="com.ERI.demo.vo.CmnDtlCdVO">
        <id column="GRP_CD" property="grpCd" />
        <id column="DTL_CD" property="dtlCd" />
        <result column="DTL_CD_NM" property="dtlCdNm" />
        <result column="DTL_CD_DESC" property="dtlCdDesc" />
        <result column="SORT_ORD" property="sortOrd" />
        <result column="USE_YN" property="useYn" />
        <result column="REG_EMP_ID" property="rgstEmpId" />
        <result column="REG_DATE" property="regDate" />
        <result column="UPD_EMP_ID" property="modEmpId" />
        <result column="UPD_DATE" property="modDate" />
    </resultMap>

    <!-- 전체 공통 상세 코드 조회 (페이징) -->
    <select id="selectAllWithPaging" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY GRP_CD, SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        <where>
            <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
                <choose>
                    <when test="pageRequest.searchField == 'grpCd'">
                        AND GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'dtlCd'">
                        AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'dtlCdNm'">
                        AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'dtlCdDesc'">
                        AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <otherwise>
                        AND (GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                    </otherwise>
                </choose>
            </if>
        </where>
        <choose>
            <when test="pageRequest.sortBy == 'grpCd'">
                ORDER BY GRP_CD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCd'">
                ORDER BY DTL_CD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdNm'">
                ORDER BY DTL_CD_NM ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdDesc'">
                ORDER BY DTL_CD_DESC ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'sortOrd'">
                ORDER BY SORT_ORD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'useYn'">
                ORDER BY USE_YN ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'regDate'">
                ORDER BY REG_DATE ${pageRequest.sortDirection}
            </when>
            <otherwise>
                ORDER BY GRP_CD, SORT_ORD, DTL_CD
            </otherwise>
        </choose>
        LIMIT #{pageRequest.size} OFFSET #{pageRequest.offset}
    </select>

    <!-- 전체 공통 상세 코드 수 조회 -->
    <select id="selectAllCount" resultType="long">
        SELECT COUNT(*)
        FROM TB_CMN_DTL_CD
        <where>
            <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
                <choose>
                    <when test="pageRequest.searchField == 'grpCd'">
                        AND GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'dtlCd'">
                        AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'dtlCdNm'">
                        AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <when test="pageRequest.searchField == 'dtlCdDesc'">
                        AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    </when>
                    <otherwise>
                        AND (GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                        OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                    </otherwise>
                </choose>
            </if>
        </where>
    </select>

    <!-- 전체 공통 상세 코드 조회 (페이징 없음) -->
    <select id="selectAll" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY GRP_CD, SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        ORDER BY GRP_CD, SORT_ORD, DTL_CD
    </select>

    <!-- 그룹 코드로 공통 상세 코드 조회 (페이징) -->
    <select id="selectByGrpCdWithPaging" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
            <choose>
                <when test="pageRequest.searchField == 'dtlCd'">
                    AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdNm'">
                    AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdDesc'">
                    AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <otherwise>
                    AND (DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                </otherwise>
            </choose>
        </if>
        <choose>
            <when test="pageRequest.sortBy == 'dtlCd'">
                ORDER BY DTL_CD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdNm'">
                ORDER BY DTL_CD_NM ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdDesc'">
                ORDER BY DTL_CD_DESC ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'sortOrd'">
                ORDER BY SORT_ORD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'useYn'">
                ORDER BY USE_YN ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'regDate'">
                ORDER BY REG_DATE ${pageRequest.sortDirection}
            </when>
            <otherwise>
                ORDER BY SORT_ORD, DTL_CD
            </otherwise>
        </choose>
        LIMIT #{pageRequest.size} OFFSET #{pageRequest.offset}
    </select>

    <!-- 그룹 코드로 공통 상세 코드 수 조회 -->
    <select id="selectByGrpCdCount" resultType="long">
        SELECT COUNT(*)
        FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
            <choose>
                <when test="pageRequest.searchField == 'dtlCd'">
                    AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdNm'">
                    AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdDesc'">
                    AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <otherwise>
                    AND (DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                </otherwise>
            </choose>
        </if>
    </select>

    <!-- 그룹 코드로 공통 상세 코드 조회 (페이징 없음) -->
    <select id="selectByGrpCd" parameterType="string" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        ORDER BY SORT_ORD, DTL_CD
    </select>

    <!-- 그룹 코드와 상세 코드로 공통 상세 코드 조회 -->
    <select id="selectByGrpCdAndDtlCd" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        AND DTL_CD = #{dtlCd}
    </select>

    <!-- 공통 상세 코드 등록 -->
    <insert id="insert" parameterType="com.ERI.demo.vo.CmnDtlCdVO">
        INSERT INTO TB_CMN_DTL_CD (
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN
        ) VALUES (
            #{grpCd},
            #{dtlCd},
            #{dtlCdNm},
            #{dtlCdDesc},
            #{sortOrd},
            #{useYn}
        )
    </insert>

    <!-- 공통 상세 코드 수정 -->
    <update id="update" parameterType="com.ERI.demo.vo.CmnDtlCdVO">
        UPDATE TB_CMN_DTL_CD
        SET 
            DTL_CD_NM = #{dtlCdNm},
            DTL_CD_DESC = #{dtlCdDesc},
            SORT_ORD = #{sortOrd},
            USE_YN = #{useYn}
        WHERE GRP_CD = #{grpCd}
        AND DTL_CD = #{dtlCd}
    </update>

    <!-- 공통 상세 코드 삭제 -->
    <delete id="deleteByGrpCdAndDtlCd">
        DELETE FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        AND DTL_CD = #{dtlCd}
    </delete>

    <!-- 그룹 코드로 공통 상세 코드 삭제 -->
    <delete id="deleteByGrpCd" parameterType="string">
        DELETE FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
    </delete>

    <!-- 사용여부로 공통 상세 코드 조회 (페이징) -->
    <select id="selectByUseYnWithPaging" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY GRP_CD, SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        WHERE USE_YN = #{useYn}
        <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
            <choose>
                <when test="pageRequest.searchField == 'grpCd'">
                    AND GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCd'">
                    AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdNm'">
                    AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdDesc'">
                    AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <otherwise>
                    AND (GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                </otherwise>
            </choose>
        </if>
        <choose>
            <when test="pageRequest.sortBy == 'grpCd'">
                ORDER BY GRP_CD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCd'">
                ORDER BY DTL_CD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdNm'">
                ORDER BY DTL_CD_NM ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdDesc'">
                ORDER BY DTL_CD_DESC ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'sortOrd'">
                ORDER BY SORT_ORD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'useYn'">
                ORDER BY USE_YN ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'regDate'">
                ORDER BY REG_DATE ${pageRequest.sortDirection}
            </when>
            <otherwise>
                ORDER BY GRP_CD, SORT_ORD, DTL_CD
            </otherwise>
        </choose>
        LIMIT #{pageRequest.size} OFFSET #{pageRequest.offset}
    </select>

    <!-- 사용여부로 공통 상세 코드 수 조회 -->
    <select id="selectByUseYnCount" resultType="long">
        SELECT COUNT(*)
        FROM TB_CMN_DTL_CD
        WHERE USE_YN = #{useYn}
        <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
            <choose>
                <when test="pageRequest.searchField == 'grpCd'">
                    AND GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCd'">
                    AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdNm'">
                    AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdDesc'">
                    AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <otherwise>
                    AND (GRP_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                </otherwise>
            </choose>
        </if>
    </select>

    <!-- 사용여부로 공통 상세 코드 조회 (페이징 없음) -->
    <select id="selectByUseYn" parameterType="string" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY GRP_CD, SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        WHERE USE_YN = #{useYn}
        ORDER BY GRP_CD, SORT_ORD, DTL_CD
    </select>

    <!-- 그룹 코드와 사용여부로 공통 상세 코드 조회 (페이징) -->
    <select id="selectByGrpCdAndUseYnWithPaging" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        AND USE_YN = #{useYn}
        <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
            <choose>
                <when test="pageRequest.searchField == 'dtlCd'">
                    AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdNm'">
                    AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdDesc'">
                    AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <otherwise>
                    AND (DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                </otherwise>
            </choose>
        </if>
        <choose>
            <when test="pageRequest.sortBy == 'dtlCd'">
                ORDER BY DTL_CD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdNm'">
                ORDER BY DTL_CD_NM ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'dtlCdDesc'">
                ORDER BY DTL_CD_DESC ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'sortOrd'">
                ORDER BY SORT_ORD ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'useYn'">
                ORDER BY USE_YN ${pageRequest.sortDirection}
            </when>
            <when test="pageRequest.sortBy == 'regDate'">
                ORDER BY REG_DATE ${pageRequest.sortDirection}
            </when>
            <otherwise>
                ORDER BY SORT_ORD, DTL_CD
            </otherwise>
        </choose>
        LIMIT #{pageRequest.size} OFFSET #{pageRequest.offset}
    </select>

    <!-- 그룹 코드와 사용여부로 공통 상세 코드 수 조회 -->
    <select id="selectByGrpCdAndUseYnCount" resultType="long">
        SELECT COUNT(*)
        FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        AND USE_YN = #{useYn}
        <if test="pageRequest.keyword != null and pageRequest.keyword != ''">
            <choose>
                <when test="pageRequest.searchField == 'dtlCd'">
                    AND DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdNm'">
                    AND DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <when test="pageRequest.searchField == 'dtlCdDesc'">
                    AND DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                </when>
                <otherwise>
                    AND (DTL_CD LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_NM LIKE CONCAT('%', #{pageRequest.keyword}, '%')
                    OR DTL_CD_DESC LIKE CONCAT('%', #{pageRequest.keyword}, '%'))
                </otherwise>
            </choose>
        </if>
    </select>

    <!-- 그룹 코드와 사용여부로 공통 상세 코드 조회 (페이징 없음) -->
    <select id="selectByGrpCdAndUseYn" resultMap="CmnDtlCdResultMap">
        SELECT 
            ROW_NUMBER() OVER (ORDER BY SORT_ORD, DTL_CD) AS rowNum,
            GRP_CD,
            DTL_CD,
            DTL_CD_NM,
            DTL_CD_DESC,
            SORT_ORD,
            USE_YN,
            REG_EMP_ID,
            REG_DATE,
            UPD_EMP_ID,
            UPD_DATE
        FROM TB_CMN_DTL_CD
        WHERE GRP_CD = #{grpCd}
        AND USE_YN = #{useYn}
        ORDER BY SORT_ORD, DTL_CD
    </select>

</mapper> 