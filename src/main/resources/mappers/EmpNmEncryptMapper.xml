<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.EmpNmEncryptMapper">

    <!-- 전체 조회 -->
    <select id="selectAll" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT * FROM TB_EMP_NM_ENCRYPT
    </select>

    <!-- 직원 ID로 조회 -->
    <select id="selectByEmpId" parameterType="string" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT * FROM TB_EMP_NM_ENCRYPT WHERE EMP_ID = #{empId}
    </select>

    <!-- 등록 -->
    <insert id="insert" parameterType="com.ERI.demo.vo.EmpNmEncryptVO">
        INSERT INTO TB_EMP_NM_ENCRYPT (
            EMP_ID, ORIG_NM, ENCRYPT_NM, ENCRYPT_ALGORITHM, ENCRYPT_KEY_ID, ENCRYPT_IV, ENCRYPT_DATE, REG_DATE, UPD_DATE
        ) VALUES (
            #{empId}, #{origNm}, #{encryptNm}, #{encryptAlgorithm}, #{encryptKeyId}, #{encryptIv}, NOW(), NOW(), NOW()
        )
    </insert>

    <!-- 수정 -->
    <update id="update" parameterType="com.ERI.demo.vo.EmpNmEncryptVO">
        UPDATE TB_EMP_NM_ENCRYPT
        SET ORIG_NM = #{origNm},
            ENCRYPT_NM = #{encryptNm},
            ENCRYPT_ALGORITHM = #{encryptAlgorithm},
            ENCRYPT_KEY_ID = #{encryptKeyId},
            ENCRYPT_IV = #{encryptIv},
            ENCRYPT_DATE = NOW(),
            UPD_DATE = NOW()
        WHERE EMP_ID = #{empId}
    </update>

    <!-- 삭제 -->
    <delete id="deleteByEmpId" parameterType="string">
        DELETE FROM TB_EMP_NM_ENCRYPT WHERE EMP_ID = #{empId}
    </delete>

    <!-- 암호화된 직원명으로 조회 -->
    <select id="selectByEncryptNm" parameterType="string" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT * FROM TB_EMP_NM_ENCRYPT WHERE ENCRYPT_NM = #{encryptNm}
    </select>

    <!-- 원본 직원명으로 조회 -->
    <select id="selectByOrigNm" parameterType="string" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT * FROM TB_EMP_NM_ENCRYPT WHERE ORIG_NM = #{origNm}
    </select>

    <!-- 알고리즘별 조회 -->
    <select id="selectByAlgorithm" parameterType="string" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT * FROM TB_EMP_NM_ENCRYPT WHERE ENCRYPT_ALGORITHM = #{algorithm}
    </select>

    <!-- 키 ID별 조회 -->
    <select id="selectByKeyId" parameterType="string" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT * FROM TB_EMP_NM_ENCRYPT WHERE ENCRYPT_KEY_ID = #{keyId}
    </select>

    <!-- 직원명 암호화 목록 조회 -->
    <select id="selectEmpNmEncryptList" parameterType="com.ERI.demo.vo.EmpNmEncryptVO" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT 
            EMP_ID,
            ORIGINAL_NAME,
            ENCRYPTED_NAME,
            KEY_ID,
            ENCRYPT_DATE,
            REG_DATE,
            UPD_DATE
        FROM TB_EMP_NM_ENCRYPT
        <where>
            <if test="empId != null and empId != ''">
                AND EMP_ID LIKE CONCAT('%', #{empId}, '%')
            </if>
        </where>
        ORDER BY REG_DATE DESC
    </select>

    <!-- 직원명 암호화 상세 조회 -->
    <select id="selectEmpNmEncrypt" parameterType="string" resultType="com.ERI.demo.vo.EmpNmEncryptVO">
        SELECT 
            EMP_ID,
            ORIGINAL_NAME,
            ENCRYPTED_NAME,
            KEY_ID,
            ENCRYPT_DATE,
            REG_DATE,
            UPD_DATE
        FROM TB_EMP_NM_ENCRYPT
        WHERE EMP_ID = #{empId}
    </select>

    <!-- 직원명 암호화 등록 -->
    <insert id="insertEmpNmEncrypt" parameterType="com.ERI.demo.vo.EmpNmEncryptVO">
        INSERT INTO TB_EMP_NM_ENCRYPT (
            EMP_ID,
            ORIGINAL_NAME,
            ENCRYPTED_NAME,
            KEY_ID,
            ENCRYPT_DATE,
            REG_DATE,
            UPD_DATE
        ) VALUES (
            #{empId},
            #{originalName},
            #{encryptedName},
            #{keyId},
            #{encryptDate},
            NOW(),
            NOW()
        )
    </insert>

    <!-- 직원명 암호화 수정 -->
    <update id="updateEmpNmEncrypt" parameterType="com.ERI.demo.vo.EmpNmEncryptVO">
        UPDATE TB_EMP_NM_ENCRYPT
        SET ORIGINAL_NAME = #{originalName},
            ENCRYPTED_NAME = #{encryptedName},
            KEY_ID = #{keyId},
            ENCRYPT_DATE = #{encryptDate},
            UPD_DATE = NOW()
        WHERE EMP_ID = #{empId}
    </update>

    <!-- 직원명 암호화 삭제 -->
    <delete id="deleteEmpNmEncrypt" parameterType="string">
        DELETE FROM TB_EMP_NM_ENCRYPT
        WHERE EMP_ID = #{empId}
    </delete>

</mapper> 