<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.CnslAppMapper">

    <!-- 상담 신청 목록 조회 (페이징) -->
    <select id="selectCnslAppList" parameterType="com.ERI.demo.vo.CnslAppVO" resultType="com.ERI.demo.vo.CnslAppVO">
        SELECT
            APP_SEQ,
            APP_DT,
            APP_TM,
            EMP_ID,
            CNSL_DT,
            CNSL_TM,
            CNSLR_EMP_ID,
            CNSL_TY_CD,
            CNSL_CNTN,
            ANONYMOUS_YN,
            APRV_STS_CD,
            APRV_EMP_ID,
            APRV_DT,
            APRV_TM,
            REJ_RSN,
            DEL_YN,
            DEL_DT,
            REG_EMP_ID,
            UPD_EMP_ID,
            REG_DT,
            UPD_DT
        FROM
            TB_CNSL_APP
        <where>
            DEL_YN = 'N'
            <if test="appDt != null">
                AND APP_DT = #{appDt}
            </if>
            <if test="appSeq != null">
                AND APP_SEQ = #{appSeq}
            </if>
            <if test="cnslTyCd != null and cnslTyCd != ''">
                AND CNSL_TY_CD = #{cnslTyCd}
            </if>
            <if test="aprvStsCd != null and aprvStsCd != ''">
                AND APRV_STS_CD = #{aprvStsCd}
            </if>
            <if test="empId != null and empId != ''">
                AND EMP_ID = #{empId}
            </if>
            <if test="cnslrEmpId != null and cnslrEmpId != ''">
                AND CNSLR_EMP_ID = #{cnslrEmpId}
            </if>
            <if test="anonymousYn != null and anonymousYn != ''">
                AND ANONYMOUS_YN = #{anonymousYn}
            </if>
            <if test="startDate != null and startDate != ''">
                AND APP_DT >= #{startDate}::date
            </if>
            <if test="endDate != null and endDate != ''">
                AND APP_DT &lt;= #{endDate}::date
            </if>
        </where>
        ORDER BY REG_DT DESC
    </select>

    <!-- 상담 신청 상세 조회 -->
    <select id="selectCnslApp" resultType="com.ERI.demo.vo.CnslAppVO">
        SELECT
            APP_SEQ,
            APP_DT,
            APP_TM,
            EMP_ID,
            CNSL_DT,
            CNSL_TM,
            CNSLR_EMP_ID,
            CNSL_TY_CD,
            CNSL_CNTN,
            ANONYMOUS_YN,
            APRV_STS_CD,
            APRV_EMP_ID,
            APRV_DT,
            APRV_TM,
            REJ_RSN,
            DEL_YN,
            DEL_DT,
            REG_EMP_ID,
            UPD_EMP_ID,
            REG_DT,
            UPD_DT
        FROM
            TB_CNSL_APP
        WHERE
            APP_SEQ = #{appSeq}
            AND DEL_YN = 'N'
    </select>

    <!-- 상담 신청 등록 -->
    <insert id="insertCnslApp" parameterType="com.ERI.demo.vo.CnslAppVO" useGeneratedKeys="true" keyProperty="appSeq">
        INSERT INTO TB_CNSL_APP (
            APP_DT,
            APP_TM,
            EMP_ID,
            CNSL_DT,
            CNSL_TM,
            CNSLR_EMP_ID,
            CNSL_TY_CD,
            CNSL_CNTN,
            ANONYMOUS_YN,
            APRV_STS_CD,
            DEL_YN,
            REG_EMP_ID,
            UPD_EMP_ID,
            REG_DT,
            UPD_DT
        ) VALUES (
            #{appDt,jdbcType=DATE},
            #{appTm,jdbcType=TIME},
            #{empId,jdbcType=VARCHAR},
            #{cnslDt,jdbcType=DATE},
            #{cnslTm,jdbcType=TIME},
            #{cnslrEmpId,jdbcType=VARCHAR},
            #{cnslTyCd,jdbcType=VARCHAR},
            #{cnslCntn,jdbcType=VARCHAR},
            #{anonymousYn,jdbcType=CHAR},
            'PENDING',
            'N',
            #{regEmpId,jdbcType=VARCHAR},
            #{updEmpId,jdbcType=VARCHAR},
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
        )
    </insert>

    <!-- 상담 신청 수정 -->
    <update id="updateCnslApp" parameterType="com.ERI.demo.vo.CnslAppVO">
        UPDATE
            TB_CNSL_APP
        <set>
            <if test="cnslDt != null">
                CNSL_DT = #{cnslDt,jdbcType=DATE},
            </if>
            <if test="cnslTm != null">
                CNSL_TM = #{cnslTm,jdbcType=TIME},
            </if>
            <if test="cnslrEmpId != null and cnslrEmpId != ''">
                CNSLR_EMP_ID = #{cnslrEmpId,jdbcType=VARCHAR},
            </if>
            <if test="cnslTyCd != null and cnslTyCd != ''">
                CNSL_TY_CD = #{cnslTyCd,jdbcType=VARCHAR},
            </if>
            <if test="cnslCntn != null and cnslCntn != ''">
                CNSL_CNTN = #{cnslCntn,jdbcType=VARCHAR},
            </if>
            <if test="anonymousYn != null and anonymousYn != ''">
                ANONYMOUS_YN = #{anonymousYn,jdbcType=CHAR},
            </if>
            <if test="aprvStsCd != null and aprvStsCd != ''">
                APRV_STS_CD = #{aprvStsCd,jdbcType=VARCHAR},
            </if>
            <if test="aprvEmpId != null and aprvEmpId != ''">
                APRV_EMP_ID = #{aprvEmpId,jdbcType=VARCHAR},
            </if>
            <if test="aprvDt != null">
                APRV_DT = #{aprvDt,jdbcType=DATE},
            </if>
            <if test="aprvTm != null">
                APRV_TM = #{aprvTm,jdbcType=TIME},
            </if>
            <if test="rejRsn != null and rejRsn != ''">
                REJ_RSN = #{rejRsn,jdbcType=VARCHAR},
            </if>
            <if test="updEmpId != null and updEmpId != ''">
                UPD_EMP_ID = #{updEmpId,jdbcType=VARCHAR},
            </if>
            UPD_DT = CURRENT_TIMESTAMP
        </set>
        WHERE
            APP_SEQ = #{appSeq,jdbcType=BIGINT}
            AND DEL_YN = 'N'
    </update>

    <!-- 상담 신청 삭제 (논리 삭제) -->
    <update id="deleteCnslApp">
        UPDATE TB_CNSL_APP
        SET 
            DEL_YN = 'Y',
            DEL_DT = CURRENT_TIMESTAMP,
            UPD_EMP_ID = #{empId,jdbcType=VARCHAR},
            UPD_DT = CURRENT_TIMESTAMP
        WHERE APP_SEQ = #{appSeq,jdbcType=BIGINT}
        AND DEL_YN = 'N'
    </update>

</mapper> 