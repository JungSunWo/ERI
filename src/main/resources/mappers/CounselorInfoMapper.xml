<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ERI.demo.mappers.CounselorInfoMapper">

    <!-- 상담사 정보 목록 조회 (페이징) -->
    <select id="selectCounselorInfoList" resultType="com.ERI.demo.vo.CounselorInfoVO">
        SELECT 
            CNSLR_EMP_ID,
            CNSLR_NM,
            CNSLR_CLSF_CD,
            CNSLR_SPCL_CD,
            CNSLR_LIC_CD,
            CNSLR_INTRO,
            CNSLR_IMG_URL,
            AVAIL_YN,
            DEL_YN,
            DEL_DT,
            REG_EMP_ID,
            UPD_EMP_ID,
            REG_DT,
            UPD_DT
        FROM TB_CNSLR_INFO
        WHERE DEL_YN = 'N'
        <if test="searchCondition != null">
            <if test="searchCondition.cnslrEmpId != null and searchCondition.cnslrEmpId != ''">
                AND CNSLR_EMP_ID = #{searchCondition.cnslrEmpId}
            </if>
            <if test="searchCondition.cnslrNm != null and searchCondition.cnslrNm != ''">
                AND CNSLR_NM LIKE CONCAT('%', #{searchCondition.cnslrNm}, '%')
            </if>
            <if test="searchCondition.cnslrClsfCd != null and searchCondition.cnslrClsfCd != ''">
                AND CNSLR_CLSF_CD = #{searchCondition.cnslrClsfCd}
            </if>
            <if test="searchCondition.cnslrSpclCd != null and searchCondition.cnslrSpclCd != ''">
                AND CNSLR_SPCL_CD = #{searchCondition.cnslrSpclCd}
            </if>
            <if test="searchCondition.cnslrLicCd != null and searchCondition.cnslrLicCd != ''">
                AND CNSLR_LIC_CD = #{searchCondition.cnslrLicCd}
            </if>
            <if test="searchCondition.availYn != null and searchCondition.availYn != ''">
                AND AVAIL_YN = #{searchCondition.availYn}
            </if>
        </if>
        ORDER BY CNSLR_NM ASC
        LIMIT #{size} OFFSET #{offset}
    </select>

    <!-- 상담사 정보 총 개수 조회 -->
    <select id="selectCounselorInfoCount" resultType="int">
        SELECT COUNT(*)
        FROM TB_CNSLR_INFO
        WHERE DEL_YN = 'N'
        <if test="searchCondition != null">
            <if test="searchCondition.cnslrEmpId != null and searchCondition.cnslrEmpId != ''">
                AND CNSLR_EMP_ID = #{searchCondition.cnslrEmpId}
            </if>
            <if test="searchCondition.cnslrNm != null and searchCondition.cnslrNm != ''">
                AND CNSLR_NM LIKE CONCAT('%', #{searchCondition.cnslrNm}, '%')
            </if>
            <if test="searchCondition.cnslrClsfCd != null and searchCondition.cnslrClsfCd != ''">
                AND CNSLR_CLSF_CD = #{searchCondition.cnslrClsfCd}
            </if>
            <if test="searchCondition.cnslrSpclCd != null and searchCondition.cnslrSpclCd != ''">
                AND CNSLR_SPCL_CD = #{searchCondition.cnslrSpclCd}
            </if>
            <if test="searchCondition.cnslrLicCd != null and searchCondition.cnslrLicCd != ''">
                AND CNSLR_LIC_CD = #{searchCondition.cnslrLicCd}
            </if>
            <if test="searchCondition.availYn != null and searchCondition.availYn != ''">
                AND AVAIL_YN = #{searchCondition.availYn}
            </if>
        </if>
    </select>

    <!-- 상담사 정보 상세 조회 -->
    <select id="selectCounselorInfoByEmpId" resultType="com.ERI.demo.vo.CounselorInfoVO">
        SELECT 
            CNSLR_EMP_ID,
            CNSLR_NM,
            CNSLR_CLSF_CD,
            CNSLR_SPCL_CD,
            CNSLR_LIC_CD,
            CNSLR_INTRO,
            CNSLR_IMG_URL,
            AVAIL_YN,
            DEL_YN,
            DEL_DT,
            REG_EMP_ID,
            UPD_EMP_ID,
            REG_DT,
            UPD_DT
        FROM TB_CNSLR_INFO
        WHERE CNSLR_EMP_ID = #{cnslrEmpId,jdbcType=VARCHAR}
        AND DEL_YN = 'N'
    </select>

    <!-- 상담사 정보 등록 -->
    <insert id="insertCounselorInfo" parameterType="com.ERI.demo.vo.CounselorInfoVO">
        INSERT INTO TB_CNSLR_INFO (
            CNSLR_EMP_ID,
            CNSLR_NM,
            CNSLR_CLSF_CD,
            CNSLR_SPCL_CD,
            CNSLR_LIC_CD,
            CNSLR_INTRO,
            CNSLR_IMG_URL,
            AVAIL_YN,
            DEL_YN,
            REG_EMP_ID,
            UPD_EMP_ID,
            REG_DT,
            UPD_DT
        ) VALUES (
            #{cnslrEmpId,jdbcType=VARCHAR},
            #{cnslrNm,jdbcType=VARCHAR},
            #{cnslrClsfCd,jdbcType=VARCHAR},
            #{cnslrSpclCd,jdbcType=VARCHAR},
            #{cnslrLicCd,jdbcType=VARCHAR},
            #{cnslrIntro,jdbcType=VARCHAR},
            #{cnslrImgUrl,jdbcType=VARCHAR},
            #{availYn,jdbcType=CHAR},
            'N',
            #{regEmpId,jdbcType=VARCHAR},
            #{updEmpId,jdbcType=VARCHAR},
            CURRENT_TIMESTAMP,
            CURRENT_TIMESTAMP
        )
    </insert>

    <!-- 상담사 정보 수정 -->
    <update id="updateCounselorInfo" parameterType="com.ERI.demo.vo.CounselorInfoVO">
        UPDATE TB_CNSLR_INFO
        SET 
            CNSLR_NM = #{cnslrNm,jdbcType=VARCHAR},
            CNSLR_CLSF_CD = #{cnslrClsfCd,jdbcType=VARCHAR},
            CNSLR_SPCL_CD = #{cnslrSpclCd,jdbcType=VARCHAR},
            CNSLR_LIC_CD = #{cnslrLicCd,jdbcType=VARCHAR},
            CNSLR_INTRO = #{cnslrIntro,jdbcType=VARCHAR},
            CNSLR_IMG_URL = #{cnslrImgUrl,jdbcType=VARCHAR},
            AVAIL_YN = #{availYn,jdbcType=CHAR},
            UPD_EMP_ID = #{updEmpId,jdbcType=VARCHAR},
            UPD_DT = CURRENT_TIMESTAMP
        WHERE CNSLR_EMP_ID = #{cnslrEmpId,jdbcType=VARCHAR}
        AND DEL_YN = 'N'
    </update>

    <!-- 상담사 정보 삭제 (논리 삭제) -->
    <update id="deleteCounselorInfo">
        UPDATE TB_CNSLR_INFO
        SET 
            DEL_YN = 'Y',
            DEL_DT = CURRENT_TIMESTAMP,
            UPD_EMP_ID = #{empId,jdbcType=VARCHAR},
            UPD_DT = CURRENT_TIMESTAMP
        WHERE CNSLR_EMP_ID = #{cnslrEmpId,jdbcType=VARCHAR}
        AND DEL_YN = 'N'
    </update>

    <!-- 상담 가능한 상담사 목록 조회 -->
    <select id="selectAvailableCounselorList" resultType="com.ERI.demo.vo.CounselorInfoVO">
        SELECT 
            CNSLR_EMP_ID,
            CNSLR_NM,
            CNSLR_CLSF_CD,
            CNSLR_SPCL_CD,
            CNSLR_LIC_CD,
            CNSLR_INTRO,
            CNSLR_IMG_URL,
            AVAIL_YN,
            DEL_YN,
            DEL_DT,
            REG_EMP_ID,
            UPD_EMP_ID,
            REG_DT,
            UPD_DT
        FROM TB_CNSLR_INFO
        WHERE AVAIL_YN = 'Y'
        AND DEL_YN = 'N'
        ORDER BY CNSLR_NM ASC
    </select>

</mapper> 